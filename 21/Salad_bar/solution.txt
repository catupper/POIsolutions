まず、各点について一番左からそこまで全てとった時の(ミカンの個数 - リンゴの個数)を求める。
x番目のフルーツにおける個の値をDif(x)とする。これは単純な累積和で求めることができる。
つぎに問題で与えられている条件に合う列の条件をDifで言い換える。
l番目からr番目の間の区間[l,r]について
左から数えた時に常にミカンの個数がリンゴより多い ⇔ l≦x≦r について　Dif(l) ≦ Dif(x)
右から数えた時に常にミカンの個数がリンゴより多い ⇔ l≦x≦r について　Dif(x) ≦ Dif(r)
よってある区間[l,r]についてどちらから数えても常にミカンの個数のほうが多い必要十分条件は
Dif(l) ≦ Dif(x) ≦ Dif(r)

あるa＜b＜c＜dについて[a,c]と[b,d]が共に条件を満たしていたら、Dif(a) ≦ Dif(b) ≦ Dif(c) ≦ Dif(d)が成り立つので、[a,d]も条件を満たす。
よって条件を満たす区間の長さが極大値を取る区間達は互いに重なり合わない。
よってしゃくとり方のように左端と右端を更新していくと、全ての極大を調べることができる。

よってO(フルーツの個数)で最大値を求めることができる。